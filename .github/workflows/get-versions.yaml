name: Get Versions

# This reusable workflow reads package version configuration from a JSON file
# and exposes it as an output for use in other workflows.
#
# Usage:
#   jobs:
#     get-versions:
#       uses: ./.github/workflows/get-versions.yaml
#
#     use-versions:
#       needs: get-versions
#       runs-on: ubuntu-latest
#       steps:
#         - name: Use versions
#           run: echo "${{ needs.get-versions.outputs.package_versions }}"

on:
  workflow_call:
    outputs:
      package_versions:
        description: "JSON string containing all package versions from dev/config/package_versions.json"
        value: ${{ jobs.get-versions.outputs.package_versions }}

  workflow_dispatch:  # Allows manual triggering for testing purposes

permissions:
  contents: read

jobs:
  get-versions:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    outputs:
      package_versions: ${{ steps.read-json.outputs.json-content }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Read and validate JSON file
        uses: durandtibo/read-json-action@v0.1
        id: read-json
        with:
          file-path: dev/config/package_versions.json

      - name: Display package versions
        run: |
          echo "ðŸ“¦ Package versions loaded successfully:"
          echo '${{ steps.read-json.outputs.json-content }}' | jq '.'
